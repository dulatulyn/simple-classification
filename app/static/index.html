<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Hamster Emotion</title>
<style>
body{font-family:system-ui,Arial;margin:0;padding:20px;background:#111;color:#eee}
.container{display:flex;gap:20px;align-items:flex-start}
.panel{display:flex;flex-direction:column;gap:10px}
#video{width:640px;height:480px;transform:scaleX(-1);background:#000}
#hamster{width:256px;height:256px;object-fit:cover;background:#222}
#label{font-size:18px}
button{padding:8px 12px}
</style>
</head>
<body>
<div class="container">
  <div class="panel">
    <button id="start">Start Camera</button>
    <div id="label">0 neutral</div>
    <video id="video" autoplay playsinline></video>
  </div>
  <div class="panel">
    <img id="hamster" src="/hamsters/neutral.png" alt="hamster">
  </div>
</div>
<canvas id="canvas" width="320" height="240" style="display:none"></canvas>
<script>
const video=document.getElementById('video');
const canvas=document.getElementById('canvas');
const ctx=canvas.getContext('2d');
const hamster=document.getElementById('hamster');
const label=document.getElementById('label');
let running=false;
async function start(){
  if(running) return;
  const stream=await navigator.mediaDevices.getUserMedia({video:true,audio:false});
  video.srcObject=stream;
  running=true;
  loop();
}
async function loop(){
  while(running){
    if(video.readyState>=2){
      ctx.drawImage(video,0,0,canvas.width,canvas.height);
      const dataUrl=canvas.toDataURL('image/jpeg',0.7);
      try{
        const r=await fetch('/predict',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({image:dataUrl})});
        const j=await r.json();
        label.textContent=j.id+' '+j.label;
        hamster.src=j.hamster_url;
      }catch(e){}
    }
    await new Promise(res=>setTimeout(res,300));
  }
}
document.getElementById('start').addEventListener('click',start);
</script>
</body>
</html>